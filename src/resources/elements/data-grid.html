<template ref="dataGrid">

    <!-- Child Grids -->
    <div if.bind="childMode">
        <div class="animated fadeIn panel panel-primary">
            <div class="panel-body">

                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                    <li>
                        <a href="#" click.delegate="hideChildren($event)" title="${'Back' | t}">
                            <i class="fa fa-caret-left"></i> ${'Back' | t} -
                            <span repeat.for="fieldName of options.children[0].childOptions.titleFieldNames">
                                ${currentRecord[fieldName]}${!$last ? ',' : ''}
                            </span>
                        </a>
                    </li>
                    <li role="presentation" class="${$first ? 'active' : ''}" repeat.for="child of options.children">
                        <a href="#${child.name}" aria-controls="${child.name}" role="tab" data-toggle="tab">${child.title | t}</a>
                    </li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane ${$first ? 'active' : ''}" id="${child.name}" repeat.for="child of options.children">

                        <data-grid parent-record.bind="currentRecord"
                                   options.bind="child"
                                   can-load.bind="childMode"></data-grid>

                    </div>
                </div>

            </div>
        </div>

    </div>
    <!-- /Child Grids -->

    <!-- Current Grid -->
    <div show.bind=" !childMode" class="data-grid animated fadeIn">
        <!-- Toolbar -->
        <div class="table-toolbar" if.bind="showToolbar">
            <div class="pull-left">
                <button if.bind="options.editing === true && formMode === true" class="btn btn-primary" click.delegate="endEditForm($event)" title="${'Back' | t}">
                    <i class="fa fa-caret-left"></i> <span class="hidden-xs"> ${'Back' | t}</span>
                </button>

                <button if.bind="options.filtering === true && formMode !== true" class="btn btn-default" click.delegate="toggleFilter($event)">
                    <i class="fa fa-filter"></i>
                </button>

                <button if.bind="options.editing === true" class="btn btn-default" click.delegate="add($event)" title="${'Add' | t}">
                    <i class="fa fa-plus"></i> <span class="hidden-xs"> ${'Add' | t}</span>
                </button>

                <button if.bind="options.editing === true" class="btn btn-default" click.delegate="edit($event)" title="${'Edit' | t}">
                    <i class="fa fa-pencil"></i> <span class="hidden-xs"> ${'Edit' | t}</span>
                </button>

                <button if.bind="options.editing === true" disabled.bind="editMode === true && isValid !== true" class="btn btn-success" click.delegate="save($event)" title="${'Save' | t}">
                    <i class="fa fa-floppy-o"></i> <span class="hidden-xs"> ${'Save' | t}</span>
                </button>

                <button if.bind="options.editing === true" class="btn btn-warning" click.delegate="cancel($event)" title="${'Cancel' | t}">
                    <i class="fa fa-ban"></i> <span class="hidden-xs"> ${'Cancel' | t}</span>
                </button>

                <div if.bind="options.toolbar.download" class="btn-group" title="${'Download' | t}">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-download"></i> <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li if.bind="options.toolbar.download.excel">
                            <a href="#"><i style="margin-right: 5px" class="fa fa-file-excel-o"></i> ${'Excel' | t}</a>
                        </li>
                        <li if.bind="options.toolbar.download.word">
                            <a href="#"><i class="fa fa-file-word-o"></i> ${'Word' | t}</a>
                        </li>
                        <li if.bind="options.toolbar.download.pdf">
                            <a href="#"><i class="fa fa-file-pdf-o"></i> ${'PDF' | t}</a>
                        </li>
                    </ul>
                </div>
                &nbsp;
                <button class="btn btn-default" click.delegate="refresh($event)" title="${'Refresh' | t}">
                    <i class="fa fa-refresh"></i>
                </button>
            </div>

            <span class="clearfix"></span>
        </div>
        <!-- /Toolbar -->

        <!-- Edit Form -->
        <div if.bind="formMode">
            <div class="panel-body">
                <data-form show-toolbar.bind="false"
                           integrated-mode.bind="true"
                           record.two-way="currentRecord"
                           options.bind="options" />
            </div>
        </div>
        <!-- /Edit Form -->

        <!-- Data area -->
        <div ref="tableContainer" class="table-responsive" show.bind="!formMode">
            <div show.bind="loading" ref="loader" style="position: absolute; background: rgba(255,255,255,0.3)">
                <div class="spinner" style="margin: 0 auto;">
                    <div style="background-color: #222" class="bounce1"></div>
                    <div style="background-color: #222" class="bounce2"></div>
                    <div style="background-color: #222" class="bounce3"></div>
                </div>
            </div>

            <table ref="table" class="table table-striped">
                <colgroup>
                    <col style="width: 100px;" />
                    <col id="col-${column.name}" style="width: 150px;" show.bind="column.hide !== true" repeat.for="column of options.columns" />
                </colgroup>
                <thead>
                    <tr>
                        <th style="width: 100px;" if.bind="options.editing === true || options.children.length > 0">
                            <div ></div>
                        </th>
                        <th id="th-${column.name}" show.bind="column.hide !== true" repeat.for="column of options.columns">
                            <div data-col="${column.name}" style="width: 150px; border-right: 5px double #ddd;padding-right: 0px;"
                                 resizable-field
                                 resizable-field-onmove.delegate="resizeColumn($event)">
                                <div class="${column.type+'-content'}" click.delegate="sort(column.name)" style="margin-right: 15px">
                                    <span>${column.title ? column.title : column.name | t}</span>
                                    <i if.bind="sortSettings.field === column.name" class="pull-right data-grid-sorter fa ${sortSettings.dir === 'asc' ? 'fa-sort-asc' : 'fa-sort-desc'}"></i>
                                    <i if.bind="sortSettings.field !== column.name" class="text-light-grey data-grid-sorter pull-right fa fa-sort"></i>
                                    <span class="clearfix"></span>
                                </div>
                            </div>
                        </th>
                    </tr>
                    <tr if.bind="options.filtering === true && filterVisible === true">
                        <th if.bind="options.editing === true"></th>
                        <th show.bind="column.hide !== true" repeat.for="column of options.columns">
                            <div if.bind="column.filter !== false" class="form-material">
                                <input class="form-control filter-input" value.bind="$parent.columnFilters[column.name]" keyup.delegate="setFilter(column.name) & debounce:300" placeholder="${'Filter...' | t}" />
                                <!-- button class="btn btn-sm btn-default">
                                    <i class="fa fa-bars"></i>
                                </button -->
                            </div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr class.bind="item === recordManager.currentRecord ? 'active' : ''" show.bind="item.state != 'deleted'" repeat.for="item of recordManager.records" click.delegate="select(item)">
                        <td if.bind="options.editing === true || options.children.length > 0">
                            <button if.bind="options.children.length > 0" class="btn btn-sm btn-default" click.delegate="showChildren(item, $event)">
                                <i class="fa fa-table"></i>
                            </button>

                            <button if.bind="options.editing === true" class="btn btn-sm btn-default" click.delegate="editForm(item, $event)">
                                <i class="fa fa-pencil"></i>
                            </button>

                            <button if.bind="options.editing === true" class="btn btn-sm btn-danger" click.delegate="remove(item, $event)">
                                <i class="fa fa-remove"></i>
                            </button>

                        </td>
                        <td class="td-${column.name}" show.bind="column.hide !== true" repeat.for="column of options.columns">
                            <field options.bind="column"
                                   integrated-mode.bind="true"
                                   edit-mode.bind="item.editMode"
                                   field-value.bind="item[column.name]"
                                   record.bind="item"
                                   with-label.bind="false"
                                   data-object.bind="dataGrid" />
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- /Data area -->

        <!-- Footer, pager -->
        <div class="table-footer" show.bind="!formMode">
            <pager class="pull-left" if.bind="options.paging !== false" ref="pager" count.bind="total" size.bind="pageSettings.size"></pager>

            <span class="clearfix"></span>
        </div>
        <!-- /Footer, pager -->

    </div>
    <!-- /Current Grid -->

</template>
