<template ref="dataGrid">

    <!-- Child Grids -->
    <div if.bind="childMode">
        <div class="animated fadeIn panel panel-primary">
            <div class="panel-body">

                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                    <li>
                        <a href="#" click.delegate="hideChildren($event)" title="${'Back' | t}">
                            <i class="fa fa-caret-left"></i> ${'Back' | t} -
                            <span repeat.for="fieldName of options.children[0].childOptions.titleFieldNames">
                                ${recordManager.currentRecord[fieldName]}${!$last ? ',' : ''}
                            </span>
                        </a>
                    </li>
                    <li role="presentation" class="${$first ? 'active' : ''}" repeat.for="child of options.children">
                        <a href="#${child.name}" aria-controls="${child.name}" role="tab" data-toggle="tab">${child.title | t}</a>
                    </li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane ${$first ? 'active' : ''}" id="${child.name}" repeat.for="child of options.children">

                        <data-grid parent-record.bind="recordManager.currentRecord"
                                   options.bind="child"
                                   can-load.bind="childMode"></data-grid>

                    </div>
                </div>

            </div>
        </div>

    </div>
    <!-- /Child Grids -->

    <!-- Current Grid -->
    <div show.bind=" !childMode" class="data-grid animated fadeIn">
        <!-- Toolbar -->
        <div class="table-toolbar" if.bind="showToolbar">
            <div class="pull-left">
                <button if.bind="options.editing === true && formMode === true" class="btn btn-primary" click.delegate="endEditForm($event)" title="${'Back' | t}">
                    <i class="fa fa-caret-left"></i> <span class="hidden-xs"> ${'Back' | t}</span>
                </button>

                <button if.bind="options.filtering === true && formMode !== true" class="btn btn-default" click.delegate="toggleFilter($event)">
                    <i class="fa fa-filter"></i>
                </button>

                <button if.bind="options.editing === true" class="btn btn-default" click.delegate="add($event)" title="${'Add' | t}">
                    <i class="fa fa-plus"></i> <span class="hidden-xs"> ${'Add' | t}</span>
                </button>

                <button if.bind="options.editing === true" class="btn btn-default" click.delegate="edit($event)" title="${'Edit' | t}">
                    <i class="fa fa-pencil"></i> <span class="hidden-xs"> ${'Edit' | t}</span>
                </button>

                <button if.bind="options.editing === true" disabled.bind="editMode === true && isValid !== true" class="btn btn-success" click.delegate="save($event)" title="${'Save' | t}">
                    <i class="fa fa-floppy-o"></i> <span class="hidden-xs"> ${'Save' | t}</span>
                </button>

                <button if.bind="options.editing === true" class="btn btn-warning" click.delegate="cancel($event)" title="${'Cancel' | t}">
                    <i class="fa fa-ban"></i> <span class="hidden-xs"> ${'Cancel' | t}</span>
                </button>

                <div if.bind="options.toolbar.download" class="btn-group" title="${'Download' | t}">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-download"></i> <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li if.bind="options.toolbar.download.excel">
                            <a href="#"><i style="margin-right: 5px" class="fa fa-file-excel-o"></i> ${'Excel' | t}</a>
                        </li>
                        <li if.bind="options.toolbar.download.word">
                            <a href="#"><i class="fa fa-file-word-o"></i> ${'Word' | t}</a>
                        </li>
                        <li if.bind="options.toolbar.download.pdf">
                            <a href="#"><i class="fa fa-file-pdf-o"></i> ${'PDF' | t}</a>
                        </li>
                    </ul>
                </div>
                &nbsp;
                <button class="btn btn-default" click.delegate="refresh($event)" title="${'Refresh' | t}">
                    <i class="fa fa-refresh"></i>
                </button>
            </div>

            <span class="clearfix"></span>
        </div>
        <!-- /Toolbar -->

        <!-- Edit Form -->
        <div show.bind="formMode">
            <div class="panel-body">
                <data-form show-toolbar.bind="false"
                           integrated-mode.bind="true"
                           record.two-way="recordManager.currentRecord"
                           options.bind="options" />
            </div>
        </div>
        <!-- /Edit Form -->

        <!-- Data area -->
        <div ref="tableContainer" show.bind="!formMode">
            <div show.bind="loading" ref="loader" class="data-grid-loader">
                <div class="spinner" style="margin: 0 auto;">
                    <div style="background-color: #222" class="bounce1"></div>
                    <div style="background-color: #222" class="bounce2"></div>
                    <div style="background-color: #222" class="bounce3"></div>
                </div>
            </div>

            <div ref="tableHeaderScroll" class="data-grid-header">
                <table ref="tableHeader" class="table table-striped">
                <thead>
                    <tr>
                        <th if.bind="options.editing === true || options.children.length > 0">
                            <div style="min-width: 100px;">&nbsp;</div>
                        </th>
                        <th id="th-${column.name}"
                            show.bind="column.hide !== true"
                            resizable-field
                            resizable-field-onmove.delegate="resizeColumn($event, column)"
                            repeat.for="column of options.columns">

                            <div class="${column.type+'-content'} column-header"
                                 click.delegate="sort(column.name)"
                                 css="width: ${column.width ? (column.width-8)+'px' : 143+'px'}">

                                <span>${column.title ? column.title : column.name | t}</span>
                                <i if.bind="sortSettings.field === column.name" class="pull-right data-grid-sorter fa ${sortSettings.dir === 'asc' ? 'fa-sort-asc' : 'fa-sort-desc'}"></i>
                                <i if.bind="sortSettings.field !== column.name" class="text-light-grey data-grid-sorter pull-right fa fa-sort"></i>
                                <span class="clearfix"></span>

                            </div>
                        </th>
                    </tr>
                    <tr if.bind="options.filtering === true && filterVisible === true" class="filter-row">
                        <th if.bind="options.editing === true" style="border-right: none;"></th>
                        <th show.bind="column.hide !== true" repeat.for="column of options.columns">
                            <div css="width: ${column.width ? (column.width)+'px' : 150+'px'}">
                                <div if.bind="column.filter !== false">
                                    <input class="form-control filter-input" value.bind="columnFilters[column.name]" keyup.delegate="setFilter(column.name) & debounce:300" placeholder="${'Filter...' | t}" />
                                    <!-- button class="btn btn-sm btn-default">
                                        <i class="fa fa-bars"></i>
                                    </button -->
                                </div>
                            </div>
                        </th>
                    </tr>
                </thead>
            </table>
            </div>

            <div ref="tableBodyScroll"
                 class="data-grid-body"
                 css="height: ${options.height ? options.height+'px' : '400px'}"
                 scroll.trigger="onScroll($event)">

                <table ref="tableBody" class="table table-striped">
                    <tbody>
                    <tr class.bind="item === recordManager.currentRecord ? 'active' : ''" show.bind="item.state != 'deleted'" repeat.for="item of recordManager.records" click.delegate="select(item)">
                        <td if.bind="options.editing === true || options.children.length > 0">
                            <div style="min-width: 100px;">
                                <button if.bind="options.children.length > 0" class="btn btn-sm btn-default" click.delegate="showChildren(item, $event)">
                                    <i class="fa fa-table"></i>
                                </button>

                                <button if.bind="options.editing === true" class="btn btn-sm btn-default" click.delegate="editForm(item, $event)">
                                    <i class="fa fa-pencil"></i>
                                </button>

                                <button if.bind="options.editing === true" class="btn btn-sm btn-danger" click.delegate="remove(item, $event)">
                                    <i class="fa fa-remove"></i>
                                </button>
                            </div>
                        </td>
                        <td class="td-${column.name}"
                            show.bind="column.hide !== true"
                            repeat.for="column of options.columns">

                            <div css="width: ${column.width ? column.width+'px' : 150+'px'}" class="td-content">
                                <field options.bind="column"
                                       integrated-mode.bind="true"
                                       edit-mode.bind="item.editMode"
                                       field-value.bind="item[column.name]"
                                       record.bind="item"
                                       with-label.bind="false"
                                       data-object.bind="dataGrid" />
                            </div>
                        </td>
                    </tr>
                </tbody>
                </table>

            </div>
        </div>
        <!-- /Data area -->

        <!-- Footer, pager -->
        <div class="table-footer" show.bind="!formMode">
            <pager class="pull-left"
                   if.bind="options.paging !== false"
                   ref="pager"
                   count.bind="total"
                   size.bind="pageSettings.size">
            </pager>

            <span class="clearfix"></span>
        </div>
        <!-- /Footer, pager -->

    </div>
    <!-- /Current Grid -->

</template>
